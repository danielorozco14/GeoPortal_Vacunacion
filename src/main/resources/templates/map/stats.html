<!DOCTYPE html>
<html>
<meta charset="utf-8" />
<head>
    <link
            rel="stylesheet"
            href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css"
            integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ=="
            crossorigin=""
    />
    <script
            src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"
            integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ=="
            crossorigin=""
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.8.0/dist/chart.min.js"></script>
    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous"/>
    <style>
        #map {
            width: 100%;
            height: 450px;
            box-shadow: 5px 5px 5px #888;
        }
        .BarChartBox{
            width: 400px;
        }
        .DonutChartBox{
            width: 400px;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg bg-light">
        <div class="container-fluid">
            <button class="navbar-toggler" type="button" data-toggle="collapse"
                    data-target="#navbarTogglerDemo01"
                    aria-controls="navbarTogglerDemo01" aria-expanded="false"
                    aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarTogglerDemo01">
                <a class="navbar-brand" href="/map/index">Geoportal Vacunacion</a>
                <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
                    <li class="nav-item active">
                        <a class="nav-link" th:href="@{/map/index}">Centros de Vacunacion</a>
                    </li>
                    <li class="nav-item active">
                        <a class="nav-link" th:href="@{/map/personas}">Personas</a>
                    </li>
                    <div class="dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false">
                            Estadisticas
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                            <li>
                                <a class="nav-link" th:href="@{/map/stats}">Estadisticas</a>
                            </li>
                            <li><a class="dropdown-item" th:href="@{/map/download}">Descargar CSV</a></li>
                        </ul>
                    </div>
                </ul>
            </div>
            <div th:substituteby="index::logout"></div>
        </div>

    </nav>




    <div id="map"></div>
    <div class="row">
        <div class="col">
            <div class="BarChartBox" style="position: relative;">
                <canvas id="barChart"></canvas>
            </div>
        </div>
        <div class="col">
            <div class="DonutChartBox" style="position: relative;">
                <canvas id="donutChart"></canvas>
            </div>
        </div>
        <div class="col"></div>
    </div>


    <!--jQuery-->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>


    <!--LEAFLET-->
    <script th:src="@{/js/L.TileLayer.BetterWMS.js}"></script>
    <script>
        var osm = L.tileLayer(
            'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
            {
                attribution:
                    '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a>' +
                    'contributors',
                maxZoom: 8,
            },
        )
        var municipios = L.tileLayer.betterWms('http://localhost:8080/geoserver/projectaca/wms', {
            layers: 'municipios',
            transparent: true,
            format: 'image/png',
            tiled: true

        });

        var departamentos = L.tileLayer.betterWms('http://localhost:8080/geoserver/projectaca/wms', {
            layers: 'departamentos',
            transparent: true,
            format: 'image/png',
            tiled: true

        });

        /*
        var municipios = L.tileLayer.wms('http://localhost:8080/geoserver/projectaca/wms', {
            layers: 'municipios',
            format: 'image/png',
            transparent: true,
            tiled: true,
            attribution: 'El Salvador',
            styles: 'projectaca:muni_densidad_casos',
        })

        var departamentos = L.tileLayer.wms('http://localhost:8080/geoserver/projectaca/wms', {
            layers: 'departamentos',
            format: 'image/png',
            transparent: true,
            tiled: true,
            attribution: 'El Salvador',
        })*/

        var baseMaps = {
            OpenStreetMap: osm,
        }
        var overlayMaps = {
            municipios: municipios,
            departamentos:departamentos
        }

        var map = L.map('map', {
            center: [13.69, -89.19],
            zoom: 8,
            layers: [osm, municipios, departamentos],
            scrollWheelZoom: false,
        })
        L.control.scale().addTo(map)
        L.control.layers(baseMaps, overlayMaps).addTo(map);
        //titulo
        var title = L.control()
        title.onAdd = function (map) {
            var div = L.DomUtil.create('div', 'info')
            div.innerHTML += '<h5> Municipios y Departamentos de El Salvador </h5>'
            return div
        }
        title.addTo(map)




        // Insertando una leyenda en el mapa
        var legend = L.control({ position: 'bottomright' })
        legend.onAdd = function (map) {
            var div = L.DomUtil.create('div', 'info legend')
            div.innerHTML +=
                '<p> <h5> Leyendas </h5> </p>' +
                '<img src="http://localhost:8080/geoserver/projectaca/wms?REQUEST=GetLegendGraphic&amp;VERSION=1.0.0&amp;FORMAT=image/png&amp;WIDTH=20&amp;HEIGHT=20&amp;LAYER=municipios" alt="legend"/> <p>Municipios</p>' +
                '<img src="http://localhost:8080/geoserver/projectaca/wms?REQUEST=GetLegendGraphic&amp;VERSION=1.0.0&amp;FORMAT=image/png&amp;WIDTH=20&amp;HEIGHT=20&amp;LAYER=departamentos" alt="legend"/> <p>Departamentos</p>';


            return div
        }
        legend.addTo(map)
    </script>

    <!--BAR CHART-->
    <script>
        const ctx = document.getElementById('barChart').getContext('2d');
        const myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
                datasets: [{
                    label: '# of Votes',
                    data: [12, 19, 3, 5, 2, 3],
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)',
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(153, 102, 255, 0.2)',
                        'rgba(255, 159, 64, 0.2)'
                    ],
                    borderColor: [
                        'rgba(255, 99, 132, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)',
                        'rgba(255, 159, 64, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                },
                responsive:true,
                maintainAspectRatio:true
            }
        });
    </script>

    <!--DONUT CHART-->
    <script>
        const donut = document.getElementById('donutChart').getContext('2d');
        const proportionsChart = new Chart(donut, {
            type: 'doughnut',
            data: {
                labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
                datasets: [{
                    label: '# of Votes',
                    data: [12, 19, 3, 5, 2, 3],
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)',
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(153, 102, 255, 0.2)',
                        'rgba(255, 159, 64, 0.2)'
                    ],
                    borderColor: [
                        'rgba(255, 99, 132, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)',
                        'rgba(255, 159, 64, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                },
                responsive:true,
                maintainAspectRatio:true
            }
        });
    </script>


    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous"></script>
</body>
</html>
